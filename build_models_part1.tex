% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={BMA\_LASSO\_Regression},
  pdfauthor={Jan Kagerhuber},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{BMA\_LASSO\_Regression}
\author{Jan Kagerhuber}
\date{2023-12-03}

\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Set the flag for PCA}
\NormalTok{USE\_PCA }\OtherTok{\textless{}{-}} \ConstantTok{TRUE}  \CommentTok{\# Change this to FALSE if not using PCA}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(glmnet)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: Matrix
\end{verbatim}

\begin{verbatim}
## Loaded glmnet 4.1-8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(caret)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: ggplot2
\end{verbatim}

\begin{verbatim}
## Loading required package: lattice
\end{verbatim}

\hypertarget{r-markdown}{%
\subsection{R Markdown}\label{r-markdown}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(data.table)}

\CommentTok{\# Define PCA prefixes and suffixes}
\NormalTok{pca\_prefix }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (USE\_PCA) }\StringTok{\textquotesingle{}pca50\_\textquotesingle{}} \ControlFlowTok{else} \StringTok{\textquotesingle{}\textquotesingle{}}
\NormalTok{pca\_suffix }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (USE\_PCA) }\StringTok{\textquotesingle{}\_pca\textquotesingle{}} \ControlFlowTok{else} \StringTok{\textquotesingle{}\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Read the CSV files}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{fread}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}datasets/train\_set\textquotesingle{}}\NormalTok{, pca\_suffix, }\StringTok{\textquotesingle{}.csv\textquotesingle{}}\NormalTok{))}
\NormalTok{test\_df }\OtherTok{\textless{}{-}} \FunctionTok{fread}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}datasets/test\_set\textquotesingle{}}\NormalTok{, pca\_suffix, }\StringTok{\textquotesingle{}.csv\textquotesingle{}}\NormalTok{))}

\CommentTok{\# Subset the data based on PCA flag}
\ControlFlowTok{if}\NormalTok{ (USE\_PCA) \{}
\NormalTok{  X }\OtherTok{\textless{}{-}}\NormalTok{ df[, }\DecValTok{5}\SpecialCharTok{:}\DecValTok{55}\NormalTok{]}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{  X }\OtherTok{\textless{}{-}}\NormalTok{ df[, }\DecValTok{4}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(df)]}
\NormalTok{\}}

\CommentTok{\# Extract the target variable}
\NormalTok{y }\OtherTok{\textless{}{-}}\NormalTok{ df}\SpecialCharTok{$}\NormalTok{cpi\_pct}

\CommentTok{\# Subset the test data}
\NormalTok{X\_test }\OtherTok{\textless{}{-}}\NormalTok{ test\_df[, .SD, .SDcols }\OtherTok{=} \FunctionTok{colnames}\NormalTok{(X)]}


\NormalTok{X }\OtherTok{\textless{}{-}} \FunctionTok{as.matrix}\NormalTok{(X)}
\NormalTok{X\_test }\OtherTok{\textless{}{-}} \FunctionTok{as.matrix}\NormalTok{(X\_test)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{as.vector}\NormalTok{(y)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(X)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           pca_0     pca_1     pca_2       pca_3     pca_4       pca_5
## [1,] -0.9811111 1.0514392 0.5009632  0.22567938 0.4735764 -0.90942322
## [2,] -1.0104561 1.0040980 0.5083044  0.24707742 0.5818173 -0.78129395
## [3,] -1.0708890 0.9170034 0.9621245  0.50801818 0.2776516 -0.07324979
## [4,] -1.1371070 0.8509130 0.8347142  0.12631227 0.3561268 -0.19761308
## [5,] -1.0713658 1.0301323 0.8837662 -0.02759388 0.5933274 -0.36548632
## [6,] -1.6814532 1.0347507 1.0560601 -0.21496258 1.0929637 -0.80353201
##           pca_6      pca_7     pca_8       pca_9     pca_10    pca_11    pca_12
## [1,] -0.3399625 0.34090594 0.4624188  0.34412231 -0.6470404 0.9482185 1.3651484
## [2,] -0.4096064 0.36297098 0.5258671  0.27784406 -0.6062044 0.5382992 1.3713747
## [3,] -0.4791632 0.08488240 0.8598406 -0.33140905 -1.2854460 0.2133784 1.0912199
## [4,] -0.7801533 0.04258955 0.7371705 -0.39265306 -1.0167799 0.4654629 0.9861138
## [5,] -0.9615049 0.15222328 0.9882578 -0.06571453 -1.0474728 0.3524463 0.9413195
## [6,] -1.7178959 0.74952416 0.9030099 -0.77720761 -1.8390051 1.0174702 2.0976615
##          pca_13     pca_14     pca_15    pca_16     pca_17     pca_18
## [1,] 1.11895281  0.8965195  0.1420933 0.9001963 -1.0303808  0.4388485
## [2,] 0.97385563  0.9483639  0.1853852 0.6750674 -1.1679484  0.5632966
## [3,] 0.63830596 -0.7385023  0.8902546 0.6175534 -0.4212285 -0.1687012
## [4,] 0.25401595 -1.1457661  0.4386546 0.7307593 -0.8670205 -0.2003010
## [5,] 0.54000525 -1.6792938  0.0663960 1.0464653 -0.5712870 -0.1932465
## [6,] 0.03624863 -3.9268826 -0.6231396 0.2117624  1.5439233  2.8524040
##          pca_19    pca_20       pca_21       pca_22     pca_23       pca_24
## [1,] -1.0123600 0.3600362 -0.167072532 -0.340553804  0.5376270 -0.784840363
## [2,] -0.8610910 0.1397215  0.020863647 -0.370964329  0.5117741 -0.659046651
## [3,] -0.4003835 1.2846222  1.137942263 -0.469847727  0.2883605 -0.854174688
## [4,] -0.2284013 1.2579128  0.556234094 -0.304266214  0.6460675 -0.139483501
## [5,] -0.4913632 1.3674183 -0.009043844  0.137797534  0.6061126 -0.005175037
## [6,] -3.2748521 1.7342529  0.227359475  0.003480559 -1.4246877 -2.587653101
##          pca_25      pca_26      pca_27    pca_28    pca_29      pca_30
## [1,] -1.9032984 -0.68509115  0.02765301 0.8143303 1.5395172 -0.01464767
## [2,] -2.0125597 -0.92234473 -0.03044808 1.3705758 1.6385308 -0.42629154
## [3,] -1.5590366 -0.73727836  1.25594936 0.6230757 1.6276022 -0.22707449
## [4,] -1.5974734 -0.05627539  0.43709441 0.4420100 1.2358350 -0.67114840
## [5,] -1.8411003  0.16728472  0.40976016 0.1029901 0.7047798 -0.55438995
## [6,]  0.5823248 -1.08377278  1.45344867 0.6977718 1.2770707  1.03395751
##           pca_31    pca_32     pca_33     pca_34      pca_35     pca_36
## [1,] -0.78608178 0.4738382  1.1991041 -0.7119750 -0.01452662 -1.8734485
## [2,] -0.92418900 0.5602839  1.2142363 -0.1095185 -0.03732268 -1.5866139
## [3,]  0.01570183 0.3951335  0.7019015 -0.3782547  0.59659770 -1.0196339
## [4,]  0.43831993 0.5357762  1.4686549 -1.4463469  0.47065053 -0.4335180
## [5,]  0.91204328 0.5383495  1.4483350 -1.9469950  0.06803313 -0.3755672
## [6,]  3.35431590 1.0148626 -3.0173725  1.0812925 -0.44130402  2.0035903
##          pca_37      pca_38      pca_39    pca_40      pca_41    pca_42
## [1,] -1.6294789  0.10351208 -0.08536167 0.4062084  0.73249213 -2.800379
## [2,] -1.0785271  0.59864818 -0.46892860 0.5778577  0.53497397 -2.811858
## [3,] -0.1817121  0.97602617 -0.04111173 1.8282299  0.37987828 -3.019318
## [4,] -0.8893839  0.70425458  0.09511381 1.2751187 -0.09134115 -2.212134
## [5,] -1.6047518  0.09876717  0.25222128 1.3973645  0.18949815 -1.440056
## [6,] -0.5308505 -0.13640340 -0.15174710 0.4035173 -0.81381184 -2.397805
##          pca_43     pca_44    pca_45      pca_46      pca_47     pca_48
## [1,] -0.2115942 -0.5121854 1.3365425 -1.75661133  0.01520495 -0.5426143
## [2,] -0.5334069 -0.4660153 1.4963134 -2.17532349  0.43005018 -0.2118911
## [3,] -0.9910152  0.3772324 0.1293237 -1.43466645  0.33945443 -0.1348987
## [4,] -2.0459884  0.6287096 0.1184809 -0.25362449 -0.48889641 -0.7533923
## [5,] -2.1745509  0.4073872 0.4306542 -0.03462285 -0.47816365 -0.7103182
## [6,]  0.2214771  1.2254890 1.0016101  0.23457057 -0.14520730  1.0898523
##         pca_49     pca_50
## [1,] 0.6463638  1.8400997
## [2,] 0.3270047  1.4686912
## [3,] 0.4113397  1.1582027
## [4,] 0.8159650  0.8569293
## [5,] 1.1640711  0.8375189
## [6,] 2.7827583 -0.3666097
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gaussian\_log\_likelihood }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(predictions, y) \{}
\NormalTok{  n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(y)}
\NormalTok{  k }\OtherTok{\textless{}{-}} \FunctionTok{ncol}\NormalTok{(predictions)}
  
\NormalTok{  residuals }\OtherTok{\textless{}{-}}\NormalTok{ y }\SpecialCharTok{{-}}\NormalTok{ predictions}
\NormalTok{  sigma\_sq }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(residuals}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, sum) }\SpecialCharTok{/}\NormalTok{ (n }\SpecialCharTok{{-}}\NormalTok{ k)}
  
\NormalTok{  log\_likelihood }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\FloatTok{0.5} \SpecialCharTok{*}\NormalTok{ (n }\SpecialCharTok{*} \FunctionTok{log}\NormalTok{(}\DecValTok{2} \SpecialCharTok{*}\NormalTok{ pi }\SpecialCharTok{*}\NormalTok{ sigma\_sq) }\SpecialCharTok{+} \FunctionTok{colSums}\NormalTok{(residuals}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ sigma\_sq)}
  
  \FunctionTok{return}\NormalTok{(log\_likelihood)}
\NormalTok{\}}




\NormalTok{lasso.bic }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x,y,}\AttributeTok{extended=}\ConstantTok{FALSE}\NormalTok{) \{}
  \CommentTok{\#Select model in LASSO path with best BIC (using LASSO regression estimates)}
  \CommentTok{\#Input}
  \CommentTok{\# {-} y: vector with response variable}
  \CommentTok{\# {-} x: design matrix}
  \CommentTok{\# {-} extended: whether to use EBIC (Chen and Chen 2008) instead of BIC}
  \CommentTok{\#}
  \CommentTok{\#Output: list with the following elements}
  \CommentTok{\# {-} coef: LASSO{-}estimated regression coefficient with lambda set via BIC}
  \CommentTok{\# {-} ypred: predicted y}
  \CommentTok{\# {-} lambda.opt: optimal value of lambda}
  \CommentTok{\# {-} lambda: data.frame with bic and number of selected variables for each value of lambda}
  
  \FunctionTok{print}\NormalTok{(}\FunctionTok{dim}\NormalTok{(x))}
  
  
  \FunctionTok{require}\NormalTok{(glmnet)}
\NormalTok{  fit }\OtherTok{\textless{}{-}} \FunctionTok{glmnet}\NormalTok{(}\AttributeTok{x=}\NormalTok{x,}\AttributeTok{y=}\NormalTok{y,}\AttributeTok{family=}\StringTok{\textquotesingle{}gaussian\textquotesingle{}}\NormalTok{,}\AttributeTok{alpha=}\DecValTok{1}\NormalTok{)}
\NormalTok{  pred }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(}\DecValTok{1}\NormalTok{,x) }\SpecialCharTok{\%*\%} \FunctionTok{rbind}\NormalTok{(fit}\SpecialCharTok{$}\NormalTok{a0,fit}\SpecialCharTok{$}\NormalTok{beta)}
  
  \CommentTok{\# print(pred)}
  
\NormalTok{  n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(y)}
\NormalTok{  p }\OtherTok{\textless{}{-}} \FunctionTok{colSums}\NormalTok{(fit}\SpecialCharTok{$}\NormalTok{beta}\SpecialCharTok{!=}\DecValTok{0}\NormalTok{) }\SpecialCharTok{+} \DecValTok{1}
  

  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\NormalTok{extended)\{}
\NormalTok{    bic }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{2} \SpecialCharTok{*} \FunctionTok{gaussian\_log\_likelihood}\NormalTok{(pred, y) }\SpecialCharTok{+}\NormalTok{ n}\SpecialCharTok{*}\NormalTok{(}\FunctionTok{log}\NormalTok{(}\DecValTok{2}\SpecialCharTok{*}\NormalTok{pi)}\SpecialCharTok{+}\DecValTok{1}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{log}\NormalTok{(n)}\SpecialCharTok{*}\NormalTok{p }
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    bic }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{2} \SpecialCharTok{*} \FunctionTok{gaussian\_log\_likelihood}\NormalTok{(pred, y) }\SpecialCharTok{+}\NormalTok{ n}\SpecialCharTok{*}\NormalTok{(}\FunctionTok{log}\NormalTok{(}\DecValTok{2}\SpecialCharTok{*}\NormalTok{pi)}\SpecialCharTok{+}\DecValTok{1}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{log}\NormalTok{(n)}\SpecialCharTok{*}\NormalTok{p }\SpecialCharTok{+} \DecValTok{2}\SpecialCharTok{*}\FunctionTok{log}\NormalTok{(}\FunctionTok{choose}\NormalTok{(}\FunctionTok{ncol}\NormalTok{(x),p))}
\NormalTok{  \}}
  
\NormalTok{  sel }\OtherTok{\textless{}{-}} \FunctionTok{which.min}\NormalTok{(bic)}
\NormalTok{  beta }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(fit}\SpecialCharTok{$}\NormalTok{a0[sel],fit}\SpecialCharTok{$}\NormalTok{beta[,sel]); }\FunctionTok{names}\NormalTok{(beta)[}\DecValTok{1}\NormalTok{]}\OtherTok{=} \StringTok{\textquotesingle{}Intercept\textquotesingle{}}
\NormalTok{  ypred }\OtherTok{\textless{}{-}}\NormalTok{ pred[,sel]}
\NormalTok{  ans }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{coef=}\NormalTok{beta,}\AttributeTok{ypred=}\NormalTok{ypred,}\AttributeTok{lambda.opt=}\NormalTok{fit}\SpecialCharTok{$}\NormalTok{lambda[sel],}\AttributeTok{lambda=}\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{lambda=}\NormalTok{fit}\SpecialCharTok{$}\NormalTok{lambda,}\AttributeTok{bic=}\NormalTok{bic,}\AttributeTok{nvars=}\NormalTok{p))}
  \FunctionTok{return}\NormalTok{(ans)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{result\_BIC }\OtherTok{\textless{}{-}} \FunctionTok{lasso.bic}\NormalTok{(X, y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 497  51
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{result\_EBIC }\OtherTok{\textless{}{-}} \FunctionTok{lasso.bic}\NormalTok{(X, y, }\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 497  51
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{result\_BIC}\SpecialCharTok{$}\NormalTok{lambda[}\FunctionTok{order}\NormalTok{(result\_BIC}\SpecialCharTok{$}\NormalTok{lambda}\SpecialCharTok{$}\NormalTok{bic), ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           lambda       bic nvars
## s23 2.024585e-04 -3070.001    20
## s27 1.395468e-04 -3067.911    28
## s33 7.985382e-05 -3066.866    35
## s28 1.271499e-04 -3064.777    30
## s25 1.680846e-04 -3064.687    25
## s26 1.531525e-04 -3063.886    27
## s32 8.763947e-05 -3062.071    35
## s29 1.158542e-04 -3060.706    32
## s34 7.275983e-05 -3058.566    37
## s24 1.844727e-04 -3058.297    24
## s31 9.618421e-05 -3056.355    35
## s35 6.629605e-05 -3055.969    38
## s30 1.055621e-04 -3055.960    34
## s22 2.221980e-04 -3055.764    20
## s36 6.040649e-05 -3052.898    39
## s20 2.676383e-04 -3046.625    16
## s21 2.438620e-04 -3045.739    19
## s37 5.504014e-05 -3043.187    41
## s19 2.937327e-04 -3042.363    14
## s18 3.223713e-04 -3037.998    12
## s40 4.163585e-05 -3036.851    43
## s39 4.569529e-05 -3035.170    43
## s17 3.538021e-04 -3033.749    10
## s38 5.015053e-05 -3033.154    43
## s42 3.456681e-05 -3027.094    45
## s41 3.793703e-05 -3025.873    45
## s16 3.882973e-04 -3024.576     9
## s15 4.261558e-04 -3020.377     7
## s44 2.869798e-05 -3016.617    47
## s43 3.149599e-05 -3015.734    47
## s14 4.677055e-04 -3012.472     6
## s45 2.614853e-05 -3011.155    48
## s12 5.633529e-04 -3005.488     3
## s13 5.133062e-04 -3004.730     5
## s48 1.978040e-05 -3000.371    50
## s47 2.170897e-05 -2999.921    50
## s46 2.382556e-05 -2999.381    50
## s11 6.182791e-04 -2997.198     3
## s59 7.108708e-06 -2996.117    51
## s58 7.801798e-06 -2996.057    51
## s57 8.562464e-06 -2995.986    51
## s56 9.397293e-06 -2995.899    51
## s55 1.031352e-05 -2995.795    51
## s54 1.131907e-05 -2995.670    51
## s53 1.242267e-05 -2995.520    51
## s52 1.363386e-05 -2995.338    51
## s51 1.496315e-05 -2995.120    51
## s50 1.642204e-05 -2994.857    51
## s49 1.802317e-05 -2994.540    51
## s71 2.327781e-06 -2990.172    52
## s70 2.554737e-06 -2990.166    52
## s69 2.803821e-06 -2990.158    52
## s68 3.077190e-06 -2990.149    52
## s67 3.377212e-06 -2990.137    52
## s66 3.706486e-06 -2990.124    52
## s65 4.067864e-06 -2990.107    52
## s64 4.464476e-06 -2990.087    52
## s63 4.899756e-06 -2990.063    52
## s62 5.377477e-06 -2990.034    52
## s61 5.901774e-06 -2990.000    52
## s60 6.477190e-06 -2989.958    52
## s10 6.785606e-04 -2987.392     3
## s9  7.447194e-04 -2975.832     3
## s8  8.173286e-04 -2962.255     3
## s7  8.970172e-04 -2946.380     3
## s6  9.844752e-04 -2927.908     3
## s5  1.080460e-03 -2921.621     2
## s4  1.185804e-03 -2908.956     2
## s3  1.301418e-03 -2894.118     2
## s2  1.428305e-03 -2876.815     2
## s1  1.567563e-03 -2856.742     2
## s0  1.720398e-03 -2839.803     1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{result\_EBIC}\SpecialCharTok{$}\NormalTok{lambda[}\FunctionTok{order}\NormalTok{(result\_EBIC}\SpecialCharTok{$}\NormalTok{lambda}\SpecialCharTok{$}\NormalTok{bic), ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           lambda       bic nvars
## s60 6.477190e-06      -Inf    52
## s61 5.901774e-06      -Inf    52
## s62 5.377477e-06      -Inf    52
## s63 4.899756e-06      -Inf    52
## s64 4.464476e-06      -Inf    52
## s65 4.067864e-06      -Inf    52
## s66 3.706486e-06      -Inf    52
## s67 3.377212e-06      -Inf    52
## s68 3.077190e-06      -Inf    52
## s69 2.803821e-06      -Inf    52
## s70 2.554737e-06      -Inf    52
## s71 2.327781e-06      -Inf    52
## s33 7.985382e-05 -3007.663    35
## s23 2.024585e-04 -3006.037    20
## s32 8.763947e-05 -3002.868    35
## s34 7.275983e-05 -3002.790    37
## s35 6.629605e-05 -3002.191    38
## s27 1.395468e-04 -3002.085    28
## s36 6.040649e-05 -3001.317    39
## s28 1.271499e-04 -3000.035    30
## s25 1.680846e-04 -2998.398    25
## s26 1.531525e-04 -2997.751    27
## s29 1.158542e-04 -2997.683    32
## s31 9.618421e-05 -2997.152    35
## s37 5.504014e-05 -2996.645    41
## s40 4.163585e-05 -2996.307    43
## s59 7.108708e-06 -2996.117    51
## s58 7.801798e-06 -2996.057    51
## s57 8.562464e-06 -2995.986    51
## s56 9.397293e-06 -2995.899    51
## s55 1.031352e-05 -2995.795    51
## s54 1.131907e-05 -2995.670    51
## s53 1.242267e-05 -2995.520    51
## s52 1.363386e-05 -2995.338    51
## s30 1.055621e-04 -2995.313    34
## s51 1.496315e-05 -2995.120    51
## s50 1.642204e-05 -2994.857    51
## s39 4.569529e-05 -2994.627    43
## s49 1.802317e-05 -2994.540    51
## s42 3.456681e-05 -2993.681    45
## s38 5.015053e-05 -2992.610    43
## s48 1.978040e-05 -2992.507    50
## s41 3.793703e-05 -2992.460    45
## s24 1.844727e-04 -2992.162    24
## s47 2.170897e-05 -2992.058    50
## s22 2.221980e-04 -2991.800    20
## s44 2.869798e-05 -2991.759    47
## s46 2.382556e-05 -2991.517    50
## s45 2.614853e-05 -2991.267    48
## s43 3.149599e-05 -2990.876    47
## s20 2.676383e-04 -2987.422    16
## s17 3.538021e-04 -2987.207    10
## s19 2.937327e-04 -2986.587    14
## s18 3.223713e-04 -2986.417    12
## s12 5.633529e-04 -2985.600     3
## s15 4.261558e-04 -2983.243     7
## s21 2.438620e-04 -2982.716    19
## s16 3.882973e-04 -2980.905     9
## s14 4.677055e-04 -2979.059     6
## s11 6.182791e-04 -2977.310     3
## s13 5.133062e-04 -2975.391     5
## s10 6.785606e-04 -2967.504     3
## s9  7.447194e-04 -2955.944     3
## s8  8.173286e-04 -2942.368     3
## s7  8.970172e-04 -2926.493     3
## s6  9.844752e-04 -2908.021     3
## s5  1.080460e-03 -2907.319     2
## s4  1.185804e-03 -2894.655     2
## s3  1.301418e-03 -2879.817     2
## s2  1.428305e-03 -2862.514     2
## s1  1.567563e-03 -2842.441     2
## s0  1.720398e-03 -2831.939     1
\end{verbatim}

\hypertarget{ebic-and-bic-return-the-same-results}{%
\subsubsection{EBIC and BIC return the same
Results}\label{ebic-and-bic-return-the-same-results}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{test\_pred\_BIC }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(}\DecValTok{1}\NormalTok{,X\_test) }\SpecialCharTok{\%*\%}\NormalTok{ result\_BIC}\SpecialCharTok{$}\NormalTok{coef}
\NormalTok{test\_pred\_EBIC }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(}\DecValTok{1}\NormalTok{,X\_test) }\SpecialCharTok{\%*\%}\NormalTok{ result\_EBIC}\SpecialCharTok{$}\NormalTok{coef}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{write.csv}\NormalTok{(result\_BIC}\SpecialCharTok{$}\NormalTok{coef, }\AttributeTok{file =} \FunctionTok{paste}\NormalTok{(}\StringTok{"models/coefs/"}\NormalTok{, pca\_prefix, }\StringTok{"lasso\_bic\_coefs.csv"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{), }\AttributeTok{row.names =} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{write.csv}\NormalTok{(result\_EBIC}\SpecialCharTok{$}\NormalTok{coef, }\AttributeTok{file =} \FunctionTok{paste}\NormalTok{(}\StringTok{"models/coefs/"}\NormalTok{, pca\_prefix, }\StringTok{"lasso\_ebic\_coefs.csv"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{), }\AttributeTok{row.names =} \ConstantTok{TRUE}\NormalTok{)}

\FunctionTok{paste}\NormalTok{(}\StringTok{"models/coefs/"}\NormalTok{, pca\_prefix, }\StringTok{"lasso\_ebic\_coefs.csv"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "models/coefs/pca50_lasso_ebic_coefs.csv"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create a data frame with the predictions}
\NormalTok{predictions\_df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{pred =}\NormalTok{ test\_pred\_BIC)}
\CommentTok{\# Write the data frame to a CSV file}
\FunctionTok{write.csv}\NormalTok{(predictions\_df, }\FunctionTok{paste}\NormalTok{(}\StringTok{"predictions/"}\NormalTok{, pca\_prefix, }\StringTok{"lasso\_bic.csv"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{))}

\CommentTok{\# Create a data frame with the predictions}
\NormalTok{predictions\_df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{pred =}\NormalTok{ test\_pred\_EBIC)}
\CommentTok{\# Write the data frame to a CSV file}


\FunctionTok{write.csv}\NormalTok{(predictions\_df, }\FunctionTok{paste}\NormalTok{(}\StringTok{"predictions/"}\NormalTok{, pca\_prefix, }\StringTok{"lasso\_ebic.csv"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{now-we-build-a-bma-regression-model}{%
\section{Now we build a BMA regression
Model}\label{now-we-build-a-bma-regression-model}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(hdm)}
\FunctionTok{library}\NormalTok{(glmnet)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --
## v dplyr     1.1.4     v readr     2.1.4
## v forcats   1.0.0     v stringr   1.5.1
## v lubridate 1.9.3     v tibble    3.2.1
## v purrr     1.0.2     v tidyr     1.3.0
## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::between()     masks data.table::between()
## x tidyr::expand()      masks Matrix::expand()
## x dplyr::filter()      masks stats::filter()
## x dplyr::first()       masks data.table::first()
## x lubridate::hour()    masks data.table::hour()
## x lubridate::isoweek() masks data.table::isoweek()
## x dplyr::lag()         masks stats::lag()
## x dplyr::last()        masks data.table::last()
## x purrr::lift()        masks caret::lift()
## x lubridate::mday()    masks data.table::mday()
## x lubridate::minute()  masks data.table::minute()
## x lubridate::month()   masks data.table::month()
## x tidyr::pack()        masks Matrix::pack()
## x lubridate::quarter() masks data.table::quarter()
## x lubridate::second()  masks data.table::second()
## x purrr::transpose()   masks data.table::transpose()
## x tidyr::unpack()      masks Matrix::unpack()
## x lubridate::wday()    masks data.table::wday()
## x lubridate::week()    masks data.table::week()
## x lubridate::yday()    masks data.table::yday()
## x lubridate::year()    masks data.table::year()
## i Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(HDCI)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'gridExtra'
## 
## The following object is masked from 'package:dplyr':
## 
##     combine
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(mombf) }\CommentTok{\# Bayesian model selection and Bayesian model averaging}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: mvtnorm
## Loading required package: ncvreg
## Loading required package: mgcv
## Loading required package: nlme
## 
## Attaching package: 'nlme'
## 
## The following object is masked from 'package:dplyr':
## 
##     collapse
## 
## This is mgcv 1.9-0. For overview type 'help("mgcv-package")'.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(rstanarm)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: Rcpp
## This is rstanarm version 2.26.1
## - See https://mc-stan.org/rstanarm/articles/priors for changes to default priors!
## - Default priors may change, so it's safest to specify priors, even if equivalent to the defaults.
## - For execution on a local, multicore CPU with excess RAM we recommend calling
##   options(mc.cores = parallel::detectCores())
## 
## Attaching package: 'rstanarm'
## 
## The following objects are masked from 'package:caret':
## 
##     compare_models, R2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mc.cores }\OtherTok{=}\NormalTok{ parallel}\SpecialCharTok{::}\FunctionTok{detectCores}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define a function to calculate scores for different \textquotesingle{}g\textquotesingle{} values}
\NormalTok{calculate\_scores }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(y\_f, x\_f, g\_range) \{}
  \CommentTok{\# Initialize an empty dataframe to store results}
\NormalTok{  result\_df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{G =} \FunctionTok{numeric}\NormalTok{(}\DecValTok{0}\NormalTok{), }\AttributeTok{Score =} \FunctionTok{numeric}\NormalTok{(}\DecValTok{0}\NormalTok{))}
  
  \CommentTok{\# Loop through the range of \textquotesingle{}g\textquotesingle{} values}
  \ControlFlowTok{for}\NormalTok{ (g }\ControlFlowTok{in}\NormalTok{ g\_range) \{}
    \CommentTok{\# Fit the model with the current \textquotesingle{}g\textquotesingle{} value}
\NormalTok{    fit }\OtherTok{\textless{}{-}} \FunctionTok{modelSelection}\NormalTok{(}\AttributeTok{y=}\NormalTok{y\_f ,}\AttributeTok{x=}\NormalTok{x\_f, }\AttributeTok{priorCoef=}\FunctionTok{zellnerprior}\NormalTok{(}\AttributeTok{taustd=}\NormalTok{g), }\AttributeTok{priorDelta=}\FunctionTok{modelbbprior}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
    
\NormalTok{    post.prob }\OtherTok{=} \FunctionTok{postProb}\NormalTok{(fit)}
    \CommentTok{\# Extract the score (the first element in the \textquotesingle{}pp\textquotesingle{} column)}
\NormalTok{    score }\OtherTok{\textless{}{-}}\NormalTok{ post.prob}\SpecialCharTok{$}\NormalTok{pp[}\DecValTok{1}\NormalTok{]}
    
    \CommentTok{\# Append the \textquotesingle{}g\textquotesingle{} and score to the result dataframe}
\NormalTok{    result\_df }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(result\_df, }\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{G =}\NormalTok{ g, }\AttributeTok{Score =}\NormalTok{ score))}
\NormalTok{  \}}
  
  \FunctionTok{return}\NormalTok{(result\_df)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g\_cv }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{/}\FloatTok{8.697490026177834e{-}05}
\NormalTok{g\_ebic\_pca }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{/}\FloatTok{3.219938e{-}04}


\FunctionTok{print}\NormalTok{(}\StringTok{"CV Lambda for normal surgests g of:"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "CV Lambda for normal surgests g of:"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(g\_cv)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 11497.57
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\StringTok{"Bic Lambda for PCA surgests g of:"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Bic Lambda for PCA surgests g of:"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(g\_ebic\_pca)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3105.65
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define a range of \textquotesingle{}g\textquotesingle{} values}
\NormalTok{g\_range }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{50}\NormalTok{, }\DecValTok{100}\NormalTok{, }\DecValTok{500}\NormalTok{, }\DecValTok{1000}\NormalTok{, }\DecValTok{1200}\NormalTok{, }\DecValTok{1500}\NormalTok{, }\DecValTok{2500}\NormalTok{, }\DecValTok{3000}\NormalTok{, }\DecValTok{5000}\NormalTok{, }\DecValTok{10000}\NormalTok{)}
\CommentTok{\# g\_range \textless{}{-} seq(0.03, 1, by = 0.03)}

\CommentTok{\# Call the function to calculate scores for different \textquotesingle{}g\textquotesingle{} values}
\NormalTok{result\_dataframe }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_scores}\NormalTok{(}\AttributeTok{y\_f =}\NormalTok{ y, }\AttributeTok{x\_f =}\NormalTok{ X, g\_range)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Greedy searching posterior mode... Done.
## Running Gibbs sampler........... Done.
## Greedy searching posterior mode... Done.
## Running Gibbs sampler........... Done.
## Greedy searching posterior mode... Done.
## Running Gibbs sampler........... Done.
## Greedy searching posterior mode... Done.
## Running Gibbs sampler........... Done.
## Greedy searching posterior mode... Done.
## Running Gibbs sampler........... Done.
## Greedy searching posterior mode... Done.
## Running Gibbs sampler........... Done.
## Greedy searching posterior mode... Done.
## Running Gibbs sampler........... Done.
## Greedy searching posterior mode... Done.
## Running Gibbs sampler........... Done.
## Greedy searching posterior mode... Done.
## Running Gibbs sampler........... Done.
## Greedy searching posterior mode... Done.
## Running Gibbs sampler........... Done.
## Greedy searching posterior mode... Done.
## Running Gibbs sampler........... Done.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{head}\NormalTok{(result\_dataframe))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      G      Score
## 1    5 0.03325845
## 2   50 0.12855052
## 3  100 0.12602248
## 4  500 0.16823111
## 5 1000 0.22938002
## 6 1200 0.24071713
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(result\_dataframe, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ G, }\AttributeTok{y =}\NormalTok{ Score)) }\SpecialCharTok{+}
\FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{"g"}\NormalTok{, }\AttributeTok{y =} \StringTok{"Model Proba"}\NormalTok{) }\SpecialCharTok{+}
\FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Best Model\_margpp vs. g"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{build_models_part1_files/figure-latex/unnamed-chunk-17-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (USE\_PCA) g\_ebic\_pca }\ControlFlowTok{else}\NormalTok{ g\_cv}

\NormalTok{margpp }\OtherTok{\textless{}{-}} \FloatTok{0.5}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit.bayesreg }\OtherTok{\textless{}{-}} \FunctionTok{modelSelection}\NormalTok{(}\AttributeTok{y=}\NormalTok{y, }\AttributeTok{x=}\NormalTok{X, }\AttributeTok{priorCoef=}\FunctionTok{zellnerprior}\NormalTok{(}\AttributeTok{taustd =}\NormalTok{ g), }\AttributeTok{priorDelta=}\FunctionTok{modelbbprior}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Greedy searching posterior mode... Done.
## Running Gibbs sampler........... Done.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(}\FunctionTok{postProb}\NormalTok{(fit.bayesreg),}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            modelid family         pp
## 1        1,2,3,4,6 normal 0.26338645
## 2          1,3,4,6 normal 0.18683734
## 3     1,2,3,4,6,14 normal 0.09549505
## 4            1,4,6 normal 0.05483728
## 5     1,2,3,4,6,19 normal 0.04079675
## 6       1,3,4,6,14 normal 0.04023464
## 7          1,2,4,6 normal 0.03970504
## 8     1,2,3,4,6,13 normal 0.02698904
## 9            1,3,4 normal 0.02619774
## 10 1,2,3,4,6,14,19 normal 0.02258066
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ci.bayesreg }\OtherTok{\textless{}{-}} \FunctionTok{coef}\NormalTok{(fit.bayesreg)[}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FunctionTok{nrow}\NormalTok{(}\FunctionTok{coef}\NormalTok{(fit.bayesreg))),]}
\NormalTok{sel.bayesreg }\OtherTok{\textless{}{-}}\NormalTok{ ci.bayesreg[,}\DecValTok{4}\NormalTok{] }\SpecialCharTok{\textgreater{}} \FloatTok{0.5}
\NormalTok{ci.bayesreg[,}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(ci.bayesreg[,}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{], }\DecValTok{3}\NormalTok{)  }
\NormalTok{ci.bayesreg[,}\DecValTok{4}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(ci.bayesreg[,}\DecValTok{4}\NormalTok{], }\DecValTok{4}\NormalTok{)      }

\NormalTok{sorted\_indices }\OtherTok{\textless{}{-}} \FunctionTok{order}\NormalTok{(ci.bayesreg[, }\StringTok{"margpp"}\NormalTok{], }\AttributeTok{decreasing =} \ConstantTok{TRUE}\NormalTok{)}

\CommentTok{\# Sort the matrix by the specified column}
\NormalTok{ci.bayesreg }\OtherTok{\textless{}{-}}\NormalTok{ ci.bayesreg[sorted\_indices, ]}

\CommentTok{\# Fill missing values with 0 using the fillna() function}
\NormalTok{ci.bayesreg }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(ci.bayesreg), }\DecValTok{0}\NormalTok{, ci.bayesreg)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(ci.bayesreg, }\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       estimate   2.5%  97.5% margpp
## pca_0   -0.002 -0.002 -0.002 1.0000
## pca_3    0.001  0.001  0.001 1.0000
## pca_5   -0.001 -0.001  0.000 0.9134
## pca_2    0.000  0.000  0.001 0.8452
## pca_1    0.000 -0.001  0.000 0.6002
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tail}\NormalTok{(ci.bayesreg, }\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        estimate 2.5% 97.5% margpp
## pca_39        0    0     0  1e-04
## pca_43        0    0     0  1e-04
## pca_45        0    0     0  1e-04
## pca_46        0    0     0  1e-04
## pca_50        0    0     0  1e-04
\end{verbatim}

choosing diffrent marginal probabilties

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(ci.bayesreg[, }\StringTok{\textquotesingle{}margpp\textquotesingle{}}\NormalTok{] }\SpecialCharTok{\textgreater{}}\NormalTok{ margpp)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bma\_betas }\OtherTok{\textless{}{-}} \FunctionTok{coef}\NormalTok{(fit.bayesreg)[, }\StringTok{"estimate"}\NormalTok{, drop }\OtherTok{=} \ConstantTok{FALSE}\NormalTok{]}
\NormalTok{bma\_betas }\OtherTok{\textless{}{-}}\NormalTok{ bma\_betas[}\SpecialCharTok{{-}}\FunctionTok{nrow}\NormalTok{(bma\_betas), ]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{dim}\NormalTok{(X\_test))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 140  51
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{dim}\NormalTok{(}\FunctionTok{cbind}\NormalTok{(}\DecValTok{1}\NormalTok{, X\_test)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 140  52
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(bma\_betas)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     intercept         pca_0         pca_1         pca_2         pca_3 
##  3.175033e-03 -1.719273e-03 -2.994877e-04  4.524468e-04  9.998320e-04 
##         pca_4 
## -9.098959e-09
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{test\_pred\_BMA }\OtherTok{\textless{}{-}}\FunctionTok{cbind}\NormalTok{(}\DecValTok{1}\NormalTok{,X\_test) }\SpecialCharTok{\%*\%}\NormalTok{ bma\_betas}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create a data frame with the predictions}
\NormalTok{predictions\_df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{pred =}\NormalTok{ test\_pred\_BMA)}
\CommentTok{\# Write the data frame to a CSV file}
\FunctionTok{write.csv}\NormalTok{(predictions\_df, }\FunctionTok{paste}\NormalTok{(}\StringTok{"predictions/"}\NormalTok{, pca\_prefix, }\StringTok{"bma.csv"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{write.csv}\NormalTok{(bma\_betas, }\AttributeTok{file =} \FunctionTok{paste}\NormalTok{(}\StringTok{"models/coefs/"}\NormalTok{, pca\_prefix, }\StringTok{"bma\_coefs.csv"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{), }\AttributeTok{row.names =} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{write.csv}\NormalTok{(}\FunctionTok{coef}\NormalTok{(fit.bayesreg), }\AttributeTok{file =} \FunctionTok{paste}\NormalTok{(}\StringTok{"models/coefs/"}\NormalTok{, pca\_prefix, }\StringTok{"bma\_coefs\_intervalls.csv"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{), }\AttributeTok{row.names =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}


\end{document}
